#==============================================================#
# VictoriaLogs Configuration
# Path: {{ victoria_logs_config_dir }}/victorialogs.yml
# Generated by Ansible - DO NOT EDIT MANUALLY
#==============================================================#

# HTTP server settings
httpListenAddr: ":{{ victoria_logs_port }}"

# Data storage settings
storageDataPath: "{{ victoria_logs_data_dir }}"

# Log level
logLevel: "{{ victoria_logs_log_level }}"

# Retention settings
retentionPeriod: {{ victoria_logs_retention_period }}

{% if victoria_logs_max_disk_usage_bytes > 0 %}
# Disk usage limit
maxDiskUsageBytes: {{ victoria_logs_max_disk_usage_bytes }}
{% endif %}

# Performance settings
maxConcurrentInserts: {{ victoria_logs_max_concurrent_inserts }}
maxLabelsPerTimeseries: {{ victoria_logs_max_labels_per_timeseries }}

{% if victoria_logs_memory_limit %}
# Memory limit
memory.allowedPercent: {{ victoria_logs_memory_limit }}
{% endif %}

# Search settings
search.maxQueryDuration: 30s
search.maxConcurrentRequests: 100

# Insert settings  
insert.maxQueueDuration: 60s

{% if victoria_logs_cluster %}
# Cluster settings
cluster.vminsertAddrs: {{ groups['infra'] | map('extract', hostvars, 'inventory_hostname') | map('regex_replace', '^(.*)$', '\\1:8480') | list | join(',') }}
cluster.vmselectAddrs: {{ groups['infra'] | map('extract', hostvars, 'inventory_hostname') | map('regex_replace', '^(.*)$', '\\1:8481') | list | join(',') }}
replicationFactor: {{ victoria_logs_replication_factor }}
{% endif %}
